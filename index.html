<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LumiQR - Minimalist QR Generator</title>

<!-- QR Code Styling -->
<script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<!-- Firebase Config -->
<script src="firebaseConfig.js"></script>

<!-- Fonts & Styles -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
body{font-family:'Inter',sans-serif;background:#f2f4f8;margin:0;padding:40px;display:flex;flex-direction:column;align-items:center;color:#1c1c1e;}
h1{text-align:center;font-weight:600;font-size:2rem;margin-bottom:30px;}
.container{display:flex;flex-wrap:wrap;justify-content:center;gap:40px;width:100%;max-width:1200px;}
.card{background:white;border-radius:24px;padding:30px;box-shadow:0 16px 40px rgba(0,0,0,0.08);transition:0.5s;position:relative;overflow:hidden;}
.card:hover{transform:translateY(-5px);box-shadow:0 24px 60px rgba(0,0,0,0.12);}
.controls{flex:1;min-width:350px;display:flex;flex-direction:column;gap:20px;}
input[type=text],input[type=color],select,input[type=file],button{padding:12px 18px;font-size:1rem;border-radius:14px;border:1px solid #ccc;background:#fafafa;transition:0.3s;}
input:focus,select:focus,input[type=color]:focus{border-color:#6366f1;box-shadow:0 0 8px rgba(99,102,241,0.2);}
button{background:#6366f1;color:white;border:none;cursor:pointer;transition:0.3s;}
button:hover{background:#4f46e5;transform:translateY(-2px);}
label{font-weight:600;font-size:0.9rem;margin-top:5px;}
.preview{flex:1;min-width:350px;display:flex;flex-direction:column;align-items:center;gap:15px;}
#qr-container{margin-top:10px;border-radius:20px;padding:20px;background:white;box-shadow:0 12px 32px rgba(0,0,0,0.06);transition: all 0.4s ease;}
.download-buttons{display:flex;gap:15px;flex-wrap:wrap;justify-content:center;margin-top:10px;}
.download-buttons button{flex:1;min-width:130px;}
.gradient-preview{width:100%;height:10px;border-radius:10px;margin-top:-10px;transition:0.4s;}
.history{margin-top:50px;width:100%;max-width:700px;}
.history h2{font-weight:600;margin-bottom:15px;}
.history-list{display:flex;flex-wrap:wrap;gap:15px;}
.history-item{width:90px;height:90px;overflow:hidden;border-radius:18px;cursor:pointer;transition:0.3s;border:1px solid #ddd;}
.history-item:hover{transform:scale(1.1);box-shadow:0 8px 20px rgba(0,0,0,0.08);}
.history-item img{width:100%;height:100%;object-fit:contain;}
.auth-buttons{display:flex;gap:15px;justify-content:center;margin-bottom:30px;}
.auth-buttons button{flex:1;min-width:140px;background:#f59e0b;}
.auth-buttons button:hover{background:#d97706;}
.card::before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(120deg,#ff7e5f,#feb47b,#86a8e7,#91eae4);filter:blur(90px);opacity:0.2;transform:translate(0,0);transition:0.8s;pointer-events:none;border-radius:50%;}
.card:hover::before{transform:translate(20px,20px);opacity:0.3;}
@media(max-width:900px){.container{flex-direction:column;align-items:center;}}
.color-preview{width:25px;height:25px;border-radius:50%;border:1px solid #aaa;margin-left:10px;display:inline-block;vertical-align:middle;}
</style>
</head>
<body>

<h1>LumiQR - Minimalist QR Generator</h1>

<div class="auth-buttons">
  <button id="signInGoogle">Sign in with Google</button>
  <button id="signOut" style="display:none;">Sign Out</button>
</div>

<div class="container">
  <div class="card controls">
    <label>Enter Text or URL</label>
    <input type="text" id="text" placeholder="https://example.com">

    <label>Foreground Color <span class="color-preview" id="fgPreview"></span></label>
    <input type="color" id="fgColor" value="#1f2937">

    <label>Background Color <span class="color-preview" id="bgPreview"></span></label>
    <input type="color" id="bgColor" value="#ffffff">

    <label>Gradient (optional, comma-separated)</label>
    <input type="text" id="gradient" placeholder="#ff7e5f,#feb47b,#86a8e7">
    <div class="gradient-preview" id="gradientPreview"></div>

    <label>Template</label>
    <select id="template">
      <option value="rounded">Rounded Dots</option>
      <option value="classic">Classic Squares</option>
      <option value="dots">Dots + Gradient</option>
    </select>

    <label>Upload Logo/Icon</label>
    <input type="file" id="logoInput" accept="image/*">

    <button id="generate">Generate QR Code</button>
  </div>

  <div class="card preview">
    <div id="qr-container"></div>
    <div class="download-buttons">
      <button id="download-png">Download PNG (Transparent)</button>
      <button id="download-svg">Download SVG</button>
    </div>
  </div>
</div>

<div class="history card">
  <h2>History</h2>
  <div class="history-list" id="historyList"></div>
</div>

<script>
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const qrContainer = document.getElementById("qr-container");
const historyList = document.getElementById("historyList");
const fgColor = document.getElementById("fgColor");
const bgColor = document.getElementById("bgColor");
const fgPreview = document.getElementById("fgPreview");
const bgPreview = document.getElementById("bgPreview");
const gradientInput = document.getElementById("gradient");
const gradientPreview = document.getElementById("gradientPreview");
let currentUser = null;

// QR Code init
let qrCode = new QRCodeStyling({
  width: 300, height: 300, data: "",
  dotsOptions: { color: fgColor.value, type: "rounded" },
  cornersSquareOptions: { type:"extra-rounded", color: fgColor.value },
  cornersDotOptions: { type:"dot", color: fgColor.value },
  backgroundOptions: { color: "#ffffff" },
  imageOptions: { crossOrigin:"anonymous", margin:5 }
});
qrCode.append(qrContainer);

// Color previews
fgPreview.style.background = fgColor.value;
bgPreview.style.background = bgColor.value;
fgColor.addEventListener("input",()=>fgPreview.style.background=fgColor.value);
bgColor.addEventListener("input",()=>bgPreview.style.background=bgColor.value);
gradientInput.addEventListener("input",()=>gradientPreview.style.background=`linear-gradient(90deg, ${gradientInput.value})`);

// Authentication
document.getElementById("signInGoogle").addEventListener("click", ()=>{
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
});
document.getElementById("signOut").addEventListener("click", ()=>auth.signOut());

auth.onAuthStateChanged(user=>{
  currentUser=user;
  document.getElementById("signInGoogle").style.display = user? "none":"inline-block";
  document.getElementById("signOut").style.display = user? "inline-block":"none";
  if(user) loadHistory();
});

// Generate QR
document.getElementById("generate").addEventListener("click",()=>{
  const text = document.getElementById("text").value;
  if(!text){alert("Enter text or URL"); return;}
  const template=document.getElementById("template").value;
  let dotsType=template==="classic"?"classy-rounded":template==="dots"?"dots":"rounded";

  let options = {
    data:text,
    dotsOptions:{ color: fgColor.value, type: dotsType },
    cornersSquareOptions:{ type:"extra-rounded", color: fgColor.value },
    cornersDotOptions:{ type:"dot", color: fgColor.value },
    backgroundOptions:{ color:"#ffffff" }
  };
  const grad=gradientInput.value;
  if(grad){
    const stops=grad.split(",").map((c,i)=>({offset:i,color:c}));
    options.dotsOptions.gradient={ type:"linear", rotation:45, colorStops:stops };
  }
  const logoFile=document.getElementById("logoInput").files[0];
  if(logoFile){
    const reader=new FileReader();
    reader.onload=function(e){options.image=e.target.result; qrCode.update(options); saveHistory(text);}
    reader.readAsDataURL(logoFile);
  } else { qrCode.update(options); saveHistory(text); }
});

// Transparent downloads
document.getElementById("download-png").addEventListener("click",()=>{
  qrCode.update({backgroundOptions:{color:"transparent"}});
  qrCode.download({name:"lumiqr",extension:"png"});
  qrCode.update({backgroundOptions:{color:"#ffffff"}});
});
document.getElementById("download-svg").addEventListener("click",()=>qrCode.download({name:"lumiqr",extension:"svg"}));

// Save history as Base64 in Firestore
function saveHistory(text){
  if(!currentUser) return;
  const tempQr = new QRCodeStyling({
    width:300,height:300,data:text,
    dotsOptions:{color:fgColor.value,type:"rounded"},
    cornersSquareOptions:{type:"extra-rounded",color:fgColor.value},
    cornersDotOptions:{type:"dot",color:fgColor.value},
    backgroundOptions:{color:"transparent"}
  });
  tempQr.getRawDataURL().then((base64)=>{
    db.collection("users").doc(currentUser.uid).collection("qrcodes").add({
      text:text,
      image:base64,
      timestamp:firebase.firestore.FieldValue.serverTimestamp()
    }).then(loadHistory);
  });
}

// Load history
function loadHistory(){
  if(!currentUser) return;
  db.collection("users").doc(currentUser.uid).collection("qrcodes")
    .orderBy("timestamp","desc").limit(10).get()
    .then(snapshot=>{
      historyList.innerHTML="";
      snapshot.forEach(doc=>{
        const div=document.createElement("div");
        div.classList.add("history-item");
        const img=document.createElement("img");
        img.src=doc.data().image;
        div.appendChild(img);
        div.onclick=()=>{
          document.getElementById("text").value=doc.data().text;
          qrCode.update({data:doc.data().text});
        };
        historyList.appendChild(div);
      });
    });
}
</script>
</body>
</html>
 
